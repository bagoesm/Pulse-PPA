import React, { useEffect, useState } from 'react';

interface MoneyBill {
  id: number;
  x: number;
  y: number;
  rotation: number;
  rotationSpeed: number;
  fallSpeed: number;
  swaySpeed: number;
  swayAmount: number;
  size: number;
  opacity: number;
}

interface MoneyAnimationProps {
  isActive: boolean;
  billCount?: number;
}

const MoneyAnimation: React.FC<MoneyAnimationProps> = ({
  isActive,
  billCount = 25
}) => {
  const [bills, setBills] = useState<MoneyBill[]>([]);

  useEffect(() => {
    if (!isActive) {
      setBills([]);
      return;
    }

    const initialBills: MoneyBill[] = Array.from({ length: billCount }, (_, i) => ({
      id: i,
      x: Math.random() * 100,
      y: -10 - Math.random() * 50,
      rotation: Math.random() * 360,
      rotationSpeed: 0.5 + Math.random() * 1.5,
      fallSpeed: 0.15 + Math.random() * 0.35,
      swaySpeed: 0.015 + Math.random() * 0.025,
      swayAmount: 2 + Math.random() * 3,
      size: 0.5 + Math.random() * 0.5,
      opacity: 0.7 + Math.random() * 0.3
    }));

    setBills(initialBills);

    let animationFrame: number;
    let frameCount = 0;

    const animate = () => {
      frameCount++;

      setBills(prevBills => {
        return prevBills.map(bill => {
          const newY = bill.y + bill.fallSpeed;
          const swayOffset = Math.sin(frameCount * bill.swaySpeed) * bill.swayAmount;
          const newX = bill.x + swayOffset * 0.05;
          const newRotation = bill.rotation + bill.rotationSpeed;

          if (newY > 110) {
            return {
              ...bill,
              x: Math.random() * 100,
              y: -10 - Math.random() * 20,
              rotation: Math.random() * 360
            };
          }

          return {
            ...bill,
            x: Math.max(0, Math.min(100, newX)),
            y: newY,
            rotation: newRotation
          };
        });
      });

      animationFrame = requestAnimationFrame(animate);
    };

    animate();

    return () => {
      if (animationFrame) {
        cancelAnimationFrame(animationFrame);
      }
    };
  }, [isActive, billCount]);

  if (!isActive || bills.length === 0) {
    return null;
  }

  return (
    <div className="absolute inset-0 pointer-events-none overflow-hidden rounded-2xl">
      {bills.map(bill => (
        <div
          key={bill.id}
          className="absolute transition-none"
          style={{
            left: `${bill.x}%`,
            top: `${bill.y}%`,
            transform: `rotate(${bill.rotation}deg) scale(${bill.size})`,
            opacity: bill.opacity,
            width: '20px',
            height: '20px'
          }}
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 38 38"
            className="w-full h-full drop-shadow-sm"
          >
            <path fill="#bad366" d="M34.329258,17.062645c-0.1363792,0.9176884-0.5651665,2.1682262-1.1638603,3.5690193v0.0011578c-1.4418297,3.382494-5.140934,10.0731373-6.5277901,11.7148914c-2.1878738,2.5947113-5.1605129,2.7461128-7.0767822,2.622448C6.412776,34.1206589,3.9417374,19.6735268,3.5510864,16.4281273c-0.0485404-0.40452,0.0624092-0.8113537,0.3085887-1.1372747C15.3856468,0.0425748,12.6201258,3.7012188,13.060771,3.1182675c0.1652746-0.2195852,0.5131626-0.1144202,0.5304956,0.1594968c0.2149715,3.396812,1.8584805,16.2767143,14.488739,17.8451042C31.3851261,21.5327816,33.7739868,20.4144173,34.329258,17.062645z" />
            <path fill="#9ebf55" d="M29.6900005,27.4819202c-0.5677834,0.9994659-2.2669773,3.9360218-3.052393,4.8657932c-2.1878738,2.5947113-5.1605129,2.7461128-7.0767822,2.622448C6.412776,34.1206589,3.9417374,19.6735268,3.5510864,16.4281273c-0.0485404-0.40452,0.0624092-0.8113537,0.3085887-1.1372747l0.709645-0.9384995c1.8781276,3.4546156,4.0602231,6.7809267,6.92769,9.4634657c3.0674133,2.8686161,6.9993467,4.9640293,11.191329,5.2136803C25.0981197,29.1728134,27.580719,28.6342201,29.6900005,27.4819202z" />
            <path fill="#bad366" d="M29.3363361,21.2049217c1.0904198-4.0844669,2.1279373-8.438529,2.8743992-12.5817175c0.0450706-0.243866,0.3698425-0.3028116,0.4923553-0.0866833c0.3710022,0.6506996,0.784771,1.6585283,1.116478,2.8258686C35.2422714,16.3676872,34.5220566,21.2049217,29.3363361,21.2049217z" />
            <path fill="#83ab44" d="M33.9732857 18.381382c.2114334-1.568718-.100811-3.4761028-.5848198-4.9813824-.031208-.0959244-.1606522-.1016941-.2045708-.0115414-.1710548.3455744-.5050735.6992331-.8298454.5790424-.3417091-.1281643-.0349197.0788851-1.868885 7.1495819-.1502476.0242805-.3051186.0439339-.4657707.0577888.8832741-3.3333874 1.7077579-6.7958107 2.3161621-10.1765528.0369835-.2011032.306282-.249651.4068336-.0716572.4646225.8171234 1.0136108 2.3138552 1.2805939 3.9238358C34.1936836 15.878973 34.3019485 17.5595646 33.9732857 18.381382z" />
            <ellipse cx="10.833" cy="17.359" fill="#83ab44" rx="2.539" ry="1.872" transform="rotate(-72.637 10.833 17.36)" />
            <path fill="#83ab44" d="M19.5908756,21.1425056c-3.3223362-1.6220951-6.5004988-0.0938129-7.0744743,3.5701923c-0.0427637,0.2669754-0.0693436,0.5432072-0.0820627,0.8275223c-0.1529675,3.6752663,2.8422794,6.5197048,6.7797556,6.5197048c2.4791298,0,4.6658459-1.2031593,5.5696583-3.0755024C26.4346066,25.5631199,23.0038815,22.8095703,19.5908756,21.1425056z" />
            <path fill="#bad366" d="M19.8231792,24.8352032c0.21381-0.3669701,0.288866-0.4312344,0.2473373-0.5582333c-0.0381622-0.1145-0.1666946-0.2082806-0.2820091-0.1941757c-0.1153526,0.0168095-0.1210098,0.0701885-0.3686905,0.4865894c-0.7426167-0.4941692-1.3707523-0.9498959-1.815712-0.2068882c-0.3966351,0.6610527-0.2999496,1.7030468,0.510849,2.5658054c-0.2382374,0.4589634-0.4881744,0.9622688-0.6969318,1.3984947c-0.4334545-0.2958736-0.7387314-0.7321663-0.9118977-1.2343693c-0.1518555-0.4302807-0.4202499-0.3701248-0.4403496,0.0069275c0.003252,0.1008587-0.0054665,0.1438808,0.0312023,0.2588902c0.1918602,0.6287479,0.5559254,1.1500015,1.0714016,1.4978886c-0.2066784,0.4413185-0.2542458,0.5005112-0.1987896,0.611393c0.0853882,0.1743412,0.3882751,0.2463017,0.4692421,0.0601025c0.0635662-0.1444702,0.1282883-0.2889423,0.1941681-0.4322567c1.5016994,0.5660496,2.8995686-0.7512722,2.4617901-1.3799839c-0.2502861-0.3583279-0.6653137-0.4796715-1.3060188-0.9974308c0.2450237-0.4703922,0.4969807-0.9361706,0.7570286-1.3973217c0.1426334,0.0887356,1.0096989,0.6063023,1.1222553,0.6264191c0.1938038,0.0346146,0.3851013-0.0710754,0.4507465-0.1930046C21.2662849,25.4813652,20.9136658,25.5268002,19.8231792,24.8352032z M19.3342915,28.2343273c-0.2322369,0.5129051-0.8967171,0.5457897-1.4620457,0.3386345c0.1955471-0.4178753,0.4273682-0.8954372,0.6287384-1.2944584C19.0910988,27.7621193,19.4893456,27.9092007,19.3342915,28.2343273z M18.4108315,26.3642845c-0.3425808-0.3755836-0.6606293-0.9572258-0.4033623-1.4007931c0.243515-0.4155598,0.6989822-0.1499462,1.1222477,0.1040211C18.8846951,25.4951572,18.6454563,25.9274139,18.4108315,26.3642845z" />
          </svg>
        </div>
      ))}
    </div>
  );
};

// Custom comparator to only re-render when isActive or billCount changes
export default React.memo(MoneyAnimation, (prevProps, nextProps) => {
  return prevProps.isActive === nextProps.isActive &&
    prevProps.billCount === nextProps.billCount;
});
